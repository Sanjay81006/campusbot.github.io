<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CampusBot</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; text-align: center; }
    #chatbox { width: 400px; margin: 30px auto; background: #fff; border-radius: 12px; box-shadow: 0px 4px 10px rgba(0,0,0,0.1); padding: 15px; }
    #messages { height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: left; }
    .msg { margin: 8px 0; padding: 8px; border-radius: 8px; max-width: 80%; }
    .user { background: #d1e7dd; margin-left: auto; }
    .bot { background: #f8d7da; margin-right: auto; }
    #input { width: 70%; padding: 8px; }
    button { padding: 8px 12px; border: none; border-radius: 6px; margin: 5px; cursor: pointer; }
    #send { background: #007bff; color: white; }
    #voice { background: #28a745; color: white; }
    #language { margin: 10px; padding: 6px; }
    #logo { width: 80px; margin-bottom: 10px; }
  </style>
</head>
<body>

  <div id="chatbox">
    <img id="logo" src="https://img.icons8.com/emoji/96/robot-emoji.png" alt="CampusBot Logo"/>
    <h2>ü§ñ CampusBot</h2>
    
    <select id="language">
      <option value="english">English</option>
      <option value="hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      <option value="telugu">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
      <option value="tamil">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
      <option value="kannada">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
    </select>

    <div id="messages"></div>

    <input type="text" id="input" placeholder="Type your question...">
    <button id="send">Send</button>
    <button id="voice">üé§ Speak</button>
  </div>

  <script>
    const messages = document.getElementById("messages");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");
    const voiceBtn = document.getElementById("voice");
    const languageSelect = document.getElementById("language");

    function appendMessage(text, sender) {
      const div = document.createElement("div");
      div.classList.add("msg", sender);
      div.innerText = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    async function sendMessage() {
      const text = input.value.trim();
      const language = languageSelect.value;
      if (!text) return;

      appendMessage(text, "user");
      input.value = "";

      const res = await fetch("http://127.0.0.1:5000/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text, language: language })
      });

      const data = await res.json();
      appendMessage(data.response, "bot");

      // Speak the bot reply
      const utterance = new SpeechSynthesisUtterance(data.response);
      utterance.lang = (language === "hindi") ? "hi-IN" : 
                       (language === "telugu") ? "te-IN" : 
                       (language === "tamil") ? "ta-IN" : 
                       (language === "kannada") ? "kn-IN" : "en-US";
      speechSynthesis.speak(utterance);
    }

    sendBtn.onclick = sendMessage;

    input.addEventListener("keypress", e => {
      if (e.key === "Enter") sendMessage();
    });

    // Voice input
    voiceBtn.onclick = () => {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = languageSelect.value === "hindi" ? "hi-IN" :
                         languageSelect.value === "telugu" ? "te-IN" :
                         languageSelect.value === "tamil" ? "ta-IN" :
                         languageSelect.value === "kannada" ? "kn-IN" : "en-US";
      recognition.start();
      recognition.onresult = (event) => {
        input.value = event.results[0][0].transcript;
        sendMessage();
      };
    };
  </script>
</body>
</html>
